# TeamT5_test

筆試題目：【寫一個script，可以在672往大鵬新城方向的公車，到達博仁醫院前3~5站時發出通知(語言/通知方法不限)】

設計方向如下：   
可以設計一個 api service 給 app 開發人員，提供以下功能給使用者：     
查詢特定公車到每站的時間   
註冊想要關注的公車和到特定站點的提醒     
提醒方式可以用 email (讓使用者輸入)，也可以考慮多重使用者的情境

***

## API 結構說明以及系統設計
#### **1. 系統架構**  
主要介接 [TDX運輸資料流通服務](https://tdx.transportdata.tw/api-service/swagger/basic/) 提供之 API，並利用 Python Flask 作為此服務的主要框架，使用者將通過 HTTP 協議發送請求，當 API 收到請求時，將回應客戶端。  

以下為此架構所包含的系統：  
(1) 前端應用程式：這裡以網頁方式呈現，提供使用者一使用者介面使用 API 服務。    
(2) 後端 API 服務：包含定義 API 端點、與 TDX 的 API 進行互動、資料處理、資料庫之CRUD、定時排程、發送郵件提醒等。  
(3) 資料庫：這裡使用 MySQL，存儲使用者註冊公車相關資訊。  
(4) TDX API：公開之運輸資料，提供公車資料以及即時到站時間。  

#### **2. Data flows**  
以下為說明及 Sequence Diagram：  
i. 查詢特定公車到各站時間  
- 使用者在前端應用程式(查詢網頁)中提供公車名稱和行進方向，發送查詢請求。  
- 前端應用程式(查詢網頁)將請求發送到 API 服務的相應端點。  
- API 服務接收請求，向 TDX API 發送請求，獲取相應的公車和到站時間資訊。  
- API 服務將公車到站時間列表回傳給前端應用程式(呈現網頁)，顯示結果給使用者。  

![image](https://github.com/haha110721/TeamT5_test/assets/66916009/424c21d9-7322-4b38-94bc-c5adb70642fe)

ii. 註冊欲關注的公車和抵達特定站點的提醒   
- 使用者在前端應用程式(註冊網頁)中填寫並提交註冊表單，包括欲通知信箱、追蹤公車名稱和特定站點等。  
- 前端應用程式(註冊網頁)將請求發送到 API 服務的相應端點。  
- API 服務接收請求，並將註冊資訊存儲到資料庫中。  
- API 服務將確認資訊回傳給前端應用程式(確認網頁)，顯示給使用者。  
- 定時排程在預定的時間間隔內執行，讀取資料庫中的使用者註冊資訊。  
- 根據使用者註冊資訊，定時排程向 TDX API 發送請求，獲取公車到站即時時間，並檢查公車到站時間是否達到提醒閾值。 
- 若即將到站，定時排程通過電子郵件發送通知給使用者。  

![image](https://github.com/haha110721/TeamT5_test/assets/66916009/e5c7ee71-3429-40b7-8d5f-aea1a32d3c50)

#### **3. User Cases**  
i. 查詢特定公車到每站的時間  
目的：查詢公車抵達各站時間，並呈現於使用者介面。  
條件：使用者至使用者介面(首頁)輸入欲查詢公車名稱以及運行方向。  
流程：  
1. 使用者發送請求到 `/` 端點，並提供公車名稱以及運行方向作為參數。  
2. API 服務接收請求，確認公車名稱是否有效。
3. API 服務向外部 API 請求公車路線及即時到站時間。
4. API 服務整理資訊並回傳公車到每站的時間列表至使用者介面。

ii. 註冊 (追蹤) 公車到站提醒  
目的：追蹤特定公車及站牌，於即將抵達時收到提醒。  
條件：使用者至使用者介面輸入使用者名稱、接收通知信箱、欲追蹤公車、運行方向以及欲追蹤站牌。    
流程：
1. 使用者發送請求到 `/subscribe` 端點，並提供使用者名稱、接收通知信箱、欲追蹤公車、運行方向以及欲追蹤站牌作為參數。  
2. API 服務接收請求，檢查資料的完整性和有效性。  
3. 若資料有效，API 服務將儲存使用者的註冊資料於資料庫。  
4. 將使用者提供之資料回傳於使用者介面，供使用者參考。

#### **4. 優化方向**
- 提供使用者取消已註冊之公車，以停止提醒
- 加入 log 紀錄程式運行訊息

***

## 其他
- 譯碼簿  
[站牌順序] /v2/Bus/StopOfRoute/City/{City}/{RouteName}

| 變數名稱  | 變數代表意義  | 變數範圍  |
| --------  | --------  | -------- |
| * RouteUID  | 路線唯一識別碼  |    |
| RouteID  | 用於地區內的路線識別碼  |      |
| * RouteName  | 公車名稱  |     |
| SubRouteUID  | 附屬路線唯一識別碼  |      |
| * Direction  | 去返程  | [0:'去程', 1:'返程', 2:'迴圈', 255:'未知']  |
| * Stops  | 所有經過的站牌  | StopUID、* StopName、* StopSequence路線經過站牌之順序  |


[預估到站時間] /v2/Bus/EstimatedTimeOfArrival/City/{City}/{RouteName}

| 變數名稱  | 變數代表意義  | 變數範圍  |
| --------  | --------  | -------- |
| StopUID  | 站牌唯一識別代碼  |   |
| * StopName  | 站牌名稱  |   |
| * RouteName  | 路線名稱  |     |
| * Direction  | 去返程(是公車路線的去返程方向)  | [0:'去程', 1:'返程', 2:'迴圈', 255:'未知']  |
| * EstimateTime  | 到站時間預估  | 單位：秒  |
| * StopCountDown  | 車輛距離本站站數  |  |
| * CurrentStop  | 車輛目前所在站牌代碼  |  |
| * StopStatus  | 車輛狀態備註  | [0:'正常', 1:'尚未發車', 2:'交管不停靠', 3:'末班車已過', 4:'今日未營運']  |
| Estimates  | 到站時間預估  | PlateNumb、EstimateTime、IsLastBus、VehicleStopStatus |

